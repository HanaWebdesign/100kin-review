<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç™¾å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>ç™¾å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿åºƒå ´</header>

  <div class="container">
    <div class="login-info">
      {% if user %}
        ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š{{ user }}
        <a href="/logout"><button>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button></a>
      {% else %}
        â€»ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“
        <a href="/login"><button>ãƒ­ã‚°ã‚¤ãƒ³</button></a>
        <a href="/register"><button>æ–°è¦ç™»éŒ²</button></a>
      {% endif %}
    </div>

{% if user %}
  <form class="review-form" method="POST" enctype="multipart/form-data" action="/">
    <input type="hidden" name="user" value="{{ user }}">
    <input type="hidden" name="user_id" value="{{ user }}">

    <div class="form-group">
      <label for="item">å•†å“åï¼š</label>
      <input type="text" id="item" name="item" required>
    </div>

    <div class="form-group">
      <label for="maker">ãƒ¡ãƒ¼ã‚«ãƒ¼åï¼ˆä»»æ„ï¼‰ï¼š</label>
      <input type="text" id="maker" name="maker">
    </div>

    <div class="form-group">
      <label>è©•ä¾¡ï¼ˆ1ã€œ5ï¼‰ï¼š</label>
      <div class="star-rating">
        {% for i in range(5, 0, -1) %}
          <input type="radio" name="rating" id="star{{ i }}" value="{{ i }}" required>
          <label for="star{{ i }}">â˜…</label>
        {% endfor %}
      </div>
    </div>

    <div class="form-group">
      <label for="comment">ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ï¼š</label>
      <textarea id="comment" name="comment" required></textarea>
    </div>

    <input type="file" name="image">
    <button type="submit">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿</button>
  </form>
{% else %}
  <p style="color: gray;">â€»æŠ•ç¨¿ãƒ»ç·¨é›†ãƒ»é€šå ±ãƒ»ã„ã„ã­ã¯ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«å¯èƒ½ã§ã™</p>
{% endif %}

    <hr>

    <h2>æŠ•ç¨¿ã•ã‚ŒãŸãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
    <ul class="review-list">
      {% for review in reviews %}
        <li class="review-item">
          <div class="review-meta">
            {% if review.maker %}ï¼ˆ{{ review.maker }}ï¼‰{% endif %}
            æŠ•ç¨¿è€…ï¼š{{ review.user or "åç„¡ã—" }}@{{ review.user_id or "unknown" }}
          </div>
          <div class="review-main">
            <strong>{{ review.item }}</strong> - è©•ä¾¡ï¼š
            <span class="stars">
              {% for i in range(1, 6) %}
                {% if i <= review.rating|int %}â˜…{% else %}â˜†{% endif %}
              {% endfor %}
            </span><br>
            æŠ•ç¨¿æ—¥ï¼š{{ review.date }}<br>
            {% if review.image_path %}
              <img src="{{ url_for('static', filename=review.image_path) }}" alt="ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ" width="200">
            {% endif %}
            <p>{{ review.comment }}</p>

            {% if review.reported %}
              <p style="color: red; font-weight: bold;">âš  é€šå ±ã•ã‚ŒãŸæŠ•ç¨¿</p>
            {% endif %}
          </div>

          {% if user and review.user_id == user %}
            <form action="/edit" method="post" style="display:inline;">
              <input type="hidden" name="index" value="{{ loop.index0 }}">
              <button type="submit">ç·¨é›†</button>
            </form>
            <form action="/delete" method="post" style="display:inline;">
              <input type="hidden" name="index" value="{{ loop.index0 }}">
              <button type="submit">å‰Šé™¤</button>
            </form>
          {% endif %}

          {% if user %}
            {% if session.get('liked_reviews') and loop.index0 in session.liked_reviews %}
              <span>ğŸ‘ ã„ã„ã­æ¸ˆï¼ˆ{{ review.likes or 0 }}ï¼‰</span>
            {% else %}
              <form action="/like" method="post" style="display:inline;">
                <input type="hidden" name="index" value="{{ loop.index0 }}">
                <button type="submit">ğŸ‘ ã„ã„ã­ï¼ˆ{{ review.likes or 0 }}ï¼‰</button>
              </form>
            {% endif %}
            <form action="/report" method="post" style="display:inline;">
              <input type="hidden" name="index" value="{{ loop.index0 }}">
              <button type="submit" onclick="return confirm('ã“ã®æŠ•ç¨¿ã‚’é€šå ±ã—ã¾ã™ã‹ï¼Ÿ');">ğŸš¨ é€šå ±</button>
            </form>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</body>
</html>
